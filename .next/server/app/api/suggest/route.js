"use strict";(()=>{var e={};e.id=566,e.ids=[566],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},7435:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var i={};t.r(i),t.d(i,{POST:()=>c});var a=t(9303),o=t(8716),s=t(670),n=t(7070),u=t(5567);let l=["New Program","Update Existing","Broken Link","Other"];async function c(e){try{let r=await e.json(),t=String(r.title||"").trim();if(!t)return n.NextResponse.json({ok:!1,error:"Missing title"},{status:400});let i=String(r.suggestionType||"New Program").trim(),a=l.includes(i)?i:"Other",o=await (0,u.xL)({title:t,suggestionType:a,relatedProgramId:r.relatedProgramId||"",programUrl:r.programUrl||"",provider:r.provider||"",category:Array.isArray(r.category)?r.category:[],stage:Array.isArray(r.stage)?r.stage:[],whatYouGet:r.whatYouGet||"",eligibility:r.eligibility||"",proposedChange:r.proposedChange||"",evidenceUrl:r.evidenceUrl||"",submitterEmail:r.submitterEmail||"",programId:r.programId||"",notes:r.notes||""});return n.NextResponse.json({ok:!0,id:o})}catch(e){return console.error(e),n.NextResponse.json({ok:!1,error:e?.message||"Server error"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/suggest/route",pathname:"/api/suggest",filename:"route",bundlePath:"app/api/suggest/route"},resolvedPagePath:"/Users/stephaniestranko/Documents/GitHub/iowastartupssource/app/api/suggest/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:d,serverHooks:m}=p,y="/api/suggest/route";function f(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},5567:(e,r,t)=>{t.d(r,{E1:()=>x,av:()=>v,xL:()=>S});var i=t(4918);let a=process.env.NOTION_TOKEN,o=process.env.NOTION_PROGRAMS_DB_ID,s=process.env.NOTION_SUGGESTIONS_DB_ID;function n(e,r){if(!r)throw Error(`Missing env var: ${e}`);return r}function u(e){return(e?.title??[]).map(e=>e.plain_text).join("")||""}function l(e){return(e?.rich_text??[]).map(e=>e.plain_text).join("")||""}function c(e){return e?.select?.name}function p(e){return e?.status?.name}function g(e){return(e?.multi_select??[]).map(e=>e.name)}function d(e){return e?.checkbox}function m(e){return e?.url}function y(e){let r=e?.number;return"number"==typeof r?r:void 0}function f(e){return e?.date?.start}function h(){return new i.KU({auth:n("NOTION_TOKEN",a)})}async function v(){let e=h(),r=n("NOTION_PROGRAMS_DB_ID",o);return(await e.databases.query({database_id:r,page_size:200,filter:{and:[{property:"Status",status:{equals:"Active"}},{property:"Needs review",checkbox:{equals:!1}}]}})).results.map(e=>{let r=e.properties??{},t=u(r.Name),i=c(r.Provider)??l(r.Provider)??"Unknown",a=g(r.Category),o=g(r.Stage)||g(r["Best For Stage"]);return{id:e.id,name:t,provider:i,category:a,offerType:c(r["Offer Type"])??l(r["Offer Type"]),valueUsdEst:y(r["Value (USD est.)"])??y(r.Value),eligibilitySummary:l(r["Eligibility Summary"])??l(r.Eligibility),requiresReferral:d(r["Requires VC/Accelerator Referral"])??d(r["Requires Referral"]),geo:c(r["Geo Restrictions"])??l(r.Geo),stage:o,applyUrl:m(r["Application Link"])??m(r["Apply URL"]),sourceUrl:m(r["Source URL"])??m(r.Source),sourceType:c(r["Source Type"])??l(r["Source Type"]),status:p(r.Status),confidence:c(r.Confidence)??l(r.Confidence),lastVerifiedAt:f(r["Last Verified"])??f(r["Last Verified At"]),needsReview:d(r["Needs review"])}})}async function x(e){let r=h();try{let t=await r.pages.retrieve({page_id:e}),i=t.properties??{},a=u(i.Name),o=c(i.Provider)??l(i.Provider)??"Unknown",s=g(i.Category),n=g(i.Stage)||g(i["Best For Stage"]);return{id:t.id,name:a,provider:o,category:s,offerType:c(i["Offer Type"])??l(i["Offer Type"]),valueUsdEst:y(i["Value (USD est.)"])??y(i.Value),eligibilitySummary:l(i["Eligibility Summary"])??l(i.Eligibility),requiresReferral:d(i["Requires VC/Accelerator Referral"])??d(i["Requires Referral"]),geo:c(i["Geo Restrictions"])??l(i.Geo),stage:n,applyUrl:m(i["Application Link"])??m(i["Apply URL"]),sourceUrl:m(i["Source URL"])??m(i.Source),sourceType:c(i["Source Type"])??l(i["Source Type"]),status:p(i.Status),confidence:c(i.Confidence)??l(i.Confidence),lastVerifiedAt:f(i["Last Verified"])??f(i["Last Verified At"]),needsReview:d(i["Needs review"])}}catch{return null}}async function S(e){let r=h();if(!a)throw Error("Missing NOTION_TOKEN");if(!s)throw Error("Missing NOTION_SUGGESTIONS_DB_ID");let t={Title:{title:[{text:{content:e.title.slice(0,2e3)}}]},"Suggestion Type":{select:{name:e.suggestionType}},Status:{select:{name:"Pending"}},...e.relatedProgramId?{"Related Program ID":{rich_text:[{text:{content:e.relatedProgramId.slice(0,2e3)}}]}}:{},...e.programUrl?{"Program URL":{url:e.programUrl}}:{},...e.provider?{Provider:{rich_text:[{text:{content:e.provider.slice(0,2e3)}}]}}:{},...Array.isArray(e.category)&&e.category.length?{Category:{multi_select:e.category.map(e=>({name:e}))}}:{},...Array.isArray(e.stage)&&e.stage.length?{Stage:{multi_select:e.stage.map(e=>({name:e}))}}:{},...e.whatYouGet?{"What you get":{rich_text:[{text:{content:e.whatYouGet.slice(0,2e3)}}]}}:{},...e.eligibility?{Eligibility:{rich_text:[{text:{content:e.eligibility.slice(0,2e3)}}]}}:{},...e.proposedChange?{"Proposed change":{rich_text:[{text:{content:e.proposedChange.slice(0,2e3)}}]}}:{},...e.evidenceUrl?{"Evidence / Source URL":{url:e.evidenceUrl}}:{},...e.submitterEmail?{"Submitter email":{email:e.submitterEmail}}:{},...e.programId?{"Program ID":{rich_text:[{text:{content:e.programId.slice(0,2e3)}}]}}:{},...e.notes?{Notes:{rich_text:[{text:{content:e.notes.slice(0,2e3)}}]}}:{}};return(await r.pages.create({parent:{database_id:s},properties:t})).id}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[276,918,972],()=>t(7435));module.exports=i})();