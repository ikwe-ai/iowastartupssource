"use strict";(()=>{var e={};e.id=152,e.ids=[152],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},1273:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var i={};r.r(i),r.d(i,{POST:()=>c});var o=r(9303),a=r(8716),n=r(670),s=r(7070),u=r(5567);function l(e){return e?e.split(",").map(e=>e.trim()).filter(Boolean):[]}async function c(e){let t=await e.formData(),r=t.get("title")?.trim()||"",i=t.get("suggestion_type")?.trim()||"Other",o=["New Program","Update Existing","Broken Link","Other"].includes(i)?i:"Other",a=t.get("related_program_id")?.trim()||void 0,n=t.get("program_url")?.trim()||void 0,c=t.get("provider")?.trim()||void 0,p=l(t.get("category")),g=l(t.get("stage")),d=t.get("what_you_get")?.trim()||void 0,m=t.get("eligibility")?.trim()||void 0,y=t.get("proposed_change")?.trim()||void 0,f=t.get("evidence_url")?.trim()||void 0,v=t.get("notes")?.trim()||void 0,_=t.get("submitter_email")?.trim()||void 0;return r?(await (0,u.xL)({title:r,suggestionType:o,relatedProgramId:a,programUrl:n,provider:c,category:p,stage:g,whatYouGet:d,eligibility:m,proposedChange:y,submitterEmail:_,evidenceUrl:f,notes:v}),s.NextResponse.redirect(new URL("/",e.url),303)):s.NextResponse.json({error:"Missing title"},{status:400})}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/suggestions/route",pathname:"/api/suggestions",filename:"route",bundlePath:"app/api/suggestions/route"},resolvedPagePath:"/Users/stephaniestranko/Documents/GitHub/iowastartupssource/app/api/suggestions/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:d,serverHooks:m}=p,y="/api/suggestions/route";function f(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},5567:(e,t,r)=>{r.d(t,{E1:()=>x,av:()=>_,xL:()=>h});var i=r(4918);let o=process.env.NOTION_TOKEN,a=process.env.NOTION_PROGRAMS_DB_ID,n=process.env.NOTION_SUGGESTIONS_DB_ID;function s(e,t){if(!t)throw Error(`Missing env var: ${e}`);return t}function u(e){return(e?.title??[]).map(e=>e.plain_text).join("")||""}function l(e){return(e?.rich_text??[]).map(e=>e.plain_text).join("")||""}function c(e){return e?.select?.name}function p(e){return e?.status?.name}function g(e){return(e?.multi_select??[]).map(e=>e.name)}function d(e){return e?.checkbox}function m(e){return e?.url}function y(e){let t=e?.number;return"number"==typeof t?t:void 0}function f(e){return e?.date?.start}function v(){return new i.KU({auth:s("NOTION_TOKEN",o)})}async function _(){let e=v(),t=s("NOTION_PROGRAMS_DB_ID",a);return(await e.databases.query({database_id:t,page_size:200,filter:{and:[{property:"Status",status:{equals:"Active"}},{property:"Needs review",checkbox:{equals:!1}}]}})).results.map(e=>{let t=e.properties??{},r=u(t.Name),i=c(t.Provider)??l(t.Provider)??"Unknown",o=g(t.Category),a=g(t.Stage)||g(t["Best For Stage"]);return{id:e.id,name:r,provider:i,category:o,offerType:c(t["Offer Type"])??l(t["Offer Type"]),valueUsdEst:y(t["Value (USD est.)"])??y(t.Value),eligibilitySummary:l(t["Eligibility Summary"])??l(t.Eligibility),requiresReferral:d(t["Requires VC/Accelerator Referral"])??d(t["Requires Referral"]),geo:c(t["Geo Restrictions"])??l(t.Geo),stage:a,applyUrl:m(t["Application Link"])??m(t["Apply URL"]),sourceUrl:m(t["Source URL"])??m(t.Source),sourceType:c(t["Source Type"])??l(t["Source Type"]),status:p(t.Status),confidence:c(t.Confidence)??l(t.Confidence),lastVerifiedAt:f(t["Last Verified"])??f(t["Last Verified At"]),needsReview:d(t["Needs review"])}})}async function x(e){let t=v();try{let r=await t.pages.retrieve({page_id:e}),i=r.properties??{},o=u(i.Name),a=c(i.Provider)??l(i.Provider)??"Unknown",n=g(i.Category),s=g(i.Stage)||g(i["Best For Stage"]);return{id:r.id,name:o,provider:a,category:n,offerType:c(i["Offer Type"])??l(i["Offer Type"]),valueUsdEst:y(i["Value (USD est.)"])??y(i.Value),eligibilitySummary:l(i["Eligibility Summary"])??l(i.Eligibility),requiresReferral:d(i["Requires VC/Accelerator Referral"])??d(i["Requires Referral"]),geo:c(i["Geo Restrictions"])??l(i.Geo),stage:s,applyUrl:m(i["Application Link"])??m(i["Apply URL"]),sourceUrl:m(i["Source URL"])??m(i.Source),sourceType:c(i["Source Type"])??l(i["Source Type"]),status:p(i.Status),confidence:c(i.Confidence)??l(i.Confidence),lastVerifiedAt:f(i["Last Verified"])??f(i["Last Verified At"]),needsReview:d(i["Needs review"])}}catch{return null}}async function h(e){let t=v();if(!o)throw Error("Missing NOTION_TOKEN");if(!n)throw Error("Missing NOTION_SUGGESTIONS_DB_ID");let r={Title:{title:[{text:{content:e.title.slice(0,2e3)}}]},"Suggestion Type":{select:{name:e.suggestionType}},Status:{select:{name:"Pending"}},...e.relatedProgramId?{"Related Program ID":{rich_text:[{text:{content:e.relatedProgramId.slice(0,2e3)}}]}}:{},...e.programUrl?{"Program URL":{url:e.programUrl}}:{},...e.provider?{Provider:{rich_text:[{text:{content:e.provider.slice(0,2e3)}}]}}:{},...Array.isArray(e.category)&&e.category.length?{Category:{multi_select:e.category.map(e=>({name:e}))}}:{},...Array.isArray(e.stage)&&e.stage.length?{Stage:{multi_select:e.stage.map(e=>({name:e}))}}:{},...e.whatYouGet?{"What you get":{rich_text:[{text:{content:e.whatYouGet.slice(0,2e3)}}]}}:{},...e.eligibility?{Eligibility:{rich_text:[{text:{content:e.eligibility.slice(0,2e3)}}]}}:{},...e.proposedChange?{"Proposed change":{rich_text:[{text:{content:e.proposedChange.slice(0,2e3)}}]}}:{},...e.evidenceUrl?{"Evidence / Source URL":{url:e.evidenceUrl}}:{},...e.submitterEmail?{"Submitter email":{email:e.submitterEmail}}:{},...e.programId?{"Program ID":{rich_text:[{text:{content:e.programId.slice(0,2e3)}}]}}:{},...e.notes?{Notes:{rich_text:[{text:{content:e.notes.slice(0,2e3)}}]}}:{}};return(await t.pages.create({parent:{database_id:n},properties:r})).id}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,918,972],()=>r(1273));module.exports=i})();